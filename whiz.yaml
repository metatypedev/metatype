meta:
    workdir: .
    watches: "meta-cli/src/**/*.rs"
    shell: "cargo run -p meta -- -C examples dev"
    envs:
        VIRTUAL_ENV: $PWD/examples/.venv
        PATH: $PWD/examples/.venv/bin:$PATH
    depends_on:
        - libs
        - typegate_native

libs:
    workdir: libs
    watches: "**/*.rs"
    shell: "cargo build -p common"

typegate:
    workdir: typegate
    watches: "src/**/*.ts"
    envs:
        TG_PORT: "7891"
    shell: "./run.sh"
    depends_on:
        - clean_deno_bindgen_cache

clean_deno_bindgen_cache:
    shell: rm -rf $(deno info --json | jq -r .denoDir)/plug/file
    depends_on:
        - typegate_native

typegate_native:
    watches:
        - "typegate/native/src/**/*.rs"
    shell: "deno_bindgen -- -p native"
    depends_on:
        - libs

website:
    workdir: website
    shell: "pnpm start --no-open"
