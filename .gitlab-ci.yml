include:
  - project: "devops/gitlab-ci-templates"
    ref: main
    file: "docker.yml"

stages:
  - bundle
  - deploy

docker:
  stage: test
  tags:
    - docker
  rules:
    - if: $CI_COMMIT_REF_NAME == "main"
  variables:
    DOCKER_DOCKERFILE: dev/Dockerfile

sync:
  stage: deploy
  tags:
    - docker
  rules:
    - if: $CI_COMMIT_REF_NAME == "main"
  variables:
    REF_SLUG: $CI_COMMIT_REF_SLUG
    CREATED_AT: $CI_PIPELINE_CREATED_AT
    SHORT_SHA: $CI_COMMIT_SHORT_SHA
  trigger:
    project: metatype/cloud
    branch: main
    strategy: depend
