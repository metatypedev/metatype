"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7330],{78209:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>c,toc:()=>u});var r=t(13274),s=t(74169),i=t(17235),l=t(38464);const a={},o="Parameter Transformations",c={id:"reference/types/parameter-transformations",title:"Parameter Transformations",description:"You might consider using parameter transformations if:",source:"@site/docs/reference/types/parameter-transformations.mdx",sourceDirName:"reference/types",slug:"/reference/types/parameter-transformations",permalink:"/docs/reference/types/parameter-transformations",draft:!1,unlisted:!1,editUrl:"https://github.com/metatypedev/metatype/tree/main/website/docs/reference/types/parameter-transformations.mdx",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Injections",permalink:"/docs/reference/types/injections"},next:{title:"Reducers",permalink:"/docs/reference/types/reducers"}},d={},u=[{value:"<code>func::reduce(tree)</code>",id:"funcreducetree",level:2},{value:"Reduce tree",id:"reduce-tree",level:3},{value:"<code>func::apply(tree)</code>",id:"funcapplytree",level:2},{value:"Apply tree",id:"apply-tree",level:3},{value:"Apply expressions",id:"apply-expressions",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"parameter-transformations",children:"Parameter Transformations"}),"\n",(0,r.jsxs)(n.admonition,{title:"Use cases",type:"info",children:[(0,r.jsx)(n.p,{children:"You might consider using parameter transformations if:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"you want a simple interface for your function but you cannot change the input type;"}),"\n",(0,r.jsx)(n.li,{children:"if you want to re-use your function with a different set of parameters."}),"\n"]})]}),"\n",(0,r.jsxs)(n.p,{children:["Parameter transformations are a way to refine the input type of your function to adapt to your need.\nThey enable you to use injection to predefined input type\nwithout manually rewriting the type to add injections.\nIt is most usefull for input types generated by runtimes, especially the ",(0,r.jsx)(n.code,{children:"PrismaRuntime"})," which generates complex input types."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Related concept:"})," ",(0,r.jsx)(n.a,{href:"./injections",children:"Injection"})]}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsxs)(n.p,{children:["In the following sections a ",(0,r.jsx)(n.em,{children:"plain object"})," means:"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"in JavaScript/TypeScript"}),": an object (literal)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"in Python"}),": a dictionary"]}),"\n"]})]}),"\n",(0,r.jsx)(n.h2,{id:"funcreducetree",children:(0,r.jsx)(n.code,{children:"func::reduce(tree)"})}),"\n",(0,r.jsx)(n.p,{children:"The reduce method allows you to only enable some paths\nin the graph of the input type of the function."}),"\n",(0,r.jsxs)(n.p,{children:["The only required parameter to ",(0,r.jsx)(n.code,{children:"func::reduce"})," is the reduce tree."]}),"\n",(0,r.jsx)(n.h3,{id:"reduce-tree",children:"Reduce tree"}),"\n",(0,r.jsxs)(n.p,{children:["A reduce tree (reduce sub-tree) is plain object\nwhose property values are either a reduce sub-tree or a ",(0,r.jsx)(n.code,{children:"g.inherit()"})," expression."]}),"\n",(0,r.jsxs)(n.p,{children:["Each plain object represents a ",(0,r.jsx)(n.code,{children:"t.struct()"})," in the input type subgraph."]}),"\n",(0,r.jsx)(n.p,{children:"All the nodes that are missing from the reduce tree will set the argument to\nits default value. Therefore they must be optional."}),"\n",(0,r.jsx)(n.p,{children:"Consider the following typegraph:"}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(l.A,{value:"typescript",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'const post = t.struct({\n    id: t.uuid(),\n    title: t.string(),\n    content: t.string(),\n});\n\nconst user = t.struct({\n    id: t.uuid(),\n    email: t.email(),\n    posts: t.list(post),\n});\n\nconst filter = t.struct({\n    id: t.uuid().optional(),\n    email: t.email().optional(),\n    posts: t.struct({\n        count: t.struct({\n            gt: t.integer({ min: 1 }).optional(),\n            lt: t.integer({ min: 1 }).optional(),\n        }),\n        tag: t.list(t.string()),\n    }),\n});\n\nconst deno = DenoRuntime();\nconst findUsers = deno.func(filter, t.list(user), { code: "..." });\n\ng.expose({\n    findUserById: findUsers.reduce({\n        id: g.inherit(),\n    }),\n    findUsersByPostCount: findUsers.reduce({\n        posts: {\n            count: g.inherit(),\n        }\n    }),\n    currentUser: findUsers.reduce({\n        id: g.inherit().fromContext("profile.userId"),\n    }),\n});\n'})})}),(0,r.jsx)(l.A,{value:"python",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'post = t.struct({\n    "id": t.uuid(),\n    "email": t.email(),\n    "posts": t.list(post),\n})\n\nuser = t.struct({\n    "id": t.uuid(),\n    "email": t.email(),\n    "posts": t.list(post),\n})\n\nfilter = t.struct({\n    "id": t.uuid().optional(),\n    "email": t.email().optional(),\n    "posts": t.struct({\n        "count": t.struct({\n            "gt": t.integer(min=1).optional(),\n            "lt": t.integer(min=1).optional(),\n        }),\n        "tag": t.list(t.string()),\n    }),\n})\n\ndeno = DenoRuntime()\nfindUsers = deno.func(filter, t.list(user), code="...")\n\ng.expose(\n    findUserById=findUsers.reduce({\n        "id": g.inherit(),\n    }),\n    findUsersByPostCount=findUsers.reduce({\n        "posts": {\n            "count": g.inherit(),\n        }\n    }),\n    currentUser=findUsers.reduce({\n        "id": g.inherit().from_context("profile.userId")\n    }),\n)\n'})})})]}),"\n",(0,r.jsx)(n.p,{children:"The following queries are valid:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query FindUsersById($id: String!) {\n    findUserById(id: $id) {\n        id\n        email\n    }\n}\n\nquery FindUsersByPostCount($min: Int!) {\n    findUsersByPostCount(posts: { count: { gt: $min } }) {\n        id\n        email\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"However the following query is invalid:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query Q {\n    findUserById(email: "user@example.com") {\n        id email\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"currentUser"})," function will not accept any parameter."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Notes"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The only fully supported non-leaf node is ",(0,r.jsx)(n.code,{children:"t.struct()"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Support for ",(0,r.jsx)(n.code,{children:"t.either()"})," and ",(0,r.jsx)(n.code,{children:"t.union()"})," is experimental."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"t.list()"})," is not supported."]}),"\n",(0,r.jsx)(n.li,{children:"Each non-leaf node may be optional or not."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"funcapplytree",children:(0,r.jsx)(n.code,{children:"func::apply(tree)"})}),"\n",(0,r.jsx)(n.p,{children:"The apply method allows you to rewrite the input type of the function,\nenabling flat input type whatever is the level of nesting in the original input type."}),"\n",(0,r.jsxs)(n.p,{children:["The only required parameter to ",(0,r.jsx)(n.code,{children:"func::apply"})," is the apply tree."]}),"\n",(0,r.jsx)(n.h3,{id:"apply-tree",children:"Apply tree"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Lexicon"}),(0,r.jsx)(n.th,{children:"Definition"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Apply node"}),(0,r.jsx)(n.td,{children:"Object node, list node or leaf-node"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Apply tree"}),(0,r.jsx)(n.td,{children:"Object node"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Object node"}),(0,r.jsxs)(n.td,{children:["A plain object whose property values are nodes. It represents a ",(0,r.jsx)(n.code,{children:"t.struct()"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"List node"}),(0,r.jsxs)(n.td,{children:["An array or list whose items are nodes. It represents a ",(0,r.jsx)(n.code,{children:"t.list()"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Leaf node"}),(0,r.jsxs)(n.td,{children:["An apply expression. See ",(0,r.jsx)(n.a,{href:"#apply-expressions",children:"below"}),"."]})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"From the code blocks in previouse section, let's make the following changes."}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(l.A,{value:"typescript",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'g.expose(\n    findUsersByPostCount: findUsers.apply({\n        posts: {\n            count: {\n                lt: g.as_arg(),\n                gt: g.as_arg(),\n            }\n        }\n    }),\n    findTechWriters: findUsers.apply({\n        posts: {\n            tags: [g.set("tech")]\n        }\n    }),\n)\n'})})}),(0,r.jsx)(l.A,{value:"python",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'g.expose(\n    findUserByPostCount=findUsers.apply({\n        "posts": {\n            "count": {\n                "lt": g.as_arg(),\n                "gt": g.as_arg(),\n            }\n        }\n    }),\n    findTechWriters=findUsers.apply({\n        "posts": {\n            "tags": [g.set("tech")]\n        }\n    }),\n)\n'})})})]}),"\n",(0,r.jsx)(n.p,{children:"In this case, the matching queries are the following:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:"query FindUsersByPostCount($lt: Int, $gt: Int) {\n    findUsersByPostCount(lt: $lt, gt: $gt) {\n        id\n        email\n    }\n}\n\nquery FindTechWriters {\n    findTechWriters {\n        id\n        email\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Those queries will be translated to the following:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-graphql",children:'query FindUsersByPostCount($lt: Int, $gt: Int) {\n    findUsers({ posts: { count: { lt: $lt, gt: $gt } } }) {\n        id\n        email\n    }\n}\n\nquery FindTechWriters {\n    findUsers({ posts: { tags: ["tech"] } }) {\n        id\n        email\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"apply-expressions",children:"Apply expressions"}),"\n",(0,r.jsx)(n.p,{children:"An apply expression indicates the source of the value for a specific leaf node\nin the apply tree."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Apply expression"}),(0,r.jsx)(n.th,{children:"Source"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"g.as_arg([name])"})}),(0,r.jsxs)(n.td,{children:["The value will be provided as a parameter, under the name ",(0,r.jsx)(n.code,{children:"name"}),". It is optional for object properties where the default is the property key."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"g.from_parent(type_name)"})}),(0,r.jsxs)(n.td,{children:["The node will have the same value as the field of the parent ",(0,r.jsx)(n.code,{children:"t.struct"})," (of the ",(0,r.jsx)(n.code,{children:"t.func"}),") that has the type name ",(0,r.jsx)(n.code,{children:"type_name"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"g.from_context(path)"})}),(0,r.jsxs)(n.td,{children:["The node will have the value of the context field accessible by the path ",(0,r.jsx)(n.code,{children:"path"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"g.from_secret(key)"})}),(0,r.jsxs)(n.td,{children:["The node will have the value of the secret named ",(0,r.jsx)(n.code,{children:"key"})," on the current typegraph."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"g.set(literal_value)"})}),(0,r.jsxs)(n.td,{children:["The passed ",(0,r.jsx)(n.code,{children:"literal_value"})," will be used."]})]})]})]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},38464:(e,n,t)=>{t.d(n,{A:()=>l});t(79474);var r=t(28923);const s={tabItem:"tabItem_1QCe"};var i=t(13274);function l(e){let{children:n,hidden:t,className:l}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,r.A)(s.tabItem,l),hidden:t,children:n})}},17235:(e,n,t)=>{t.d(n,{A:()=>I});var r=t(79474),s=t(28923),i=t(96231),l=t(20241),a=t(9282),o=t(76872),c=t(38649),d=t(5915);function u(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:s}}=e;return{value:n,label:t,attributes:r,default:s}}))}(t);return function(e){const n=(0,c.X)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function f(e){let{queryString:n=!1,groupId:t}=e;const s=(0,l.W6)(),i=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,o.aZ)(i),(0,r.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(s.location.search);n.set(i,e),s.replace({...s.location,search:n.toString()})}),[i,s])]}function x(e){const{defaultValue:n,queryString:t=!1,groupId:s}=e,i=h(e),[l,o]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=t.find((e=>e.default))??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:i}))),[c,u]=f({queryString:t,groupId:s}),[x,m]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,i]=(0,d.Dv)(t);return[s,(0,r.useCallback)((e=>{t&&i.set(e)}),[t,i])]}({groupId:s}),j=(()=>{const e=c??x;return p({value:e,tabValues:i})?e:null})();(0,a.A)((()=>{j&&o(j)}),[j]);return{selectedValue:l,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);o(e),u(e),m(e)}),[u,m,i]),tabValues:i}}var m=t(78618);const j={tabList:"tabList_sxDD",tabItem:"tabItem_dlhm"};var y=t(13274);function g(e){let{className:n,block:t,selectedValue:r,selectValue:l,tabValues:a}=e;const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.a_)(),d=e=>{const n=e.currentTarget,t=o.indexOf(n),s=a[t].value;s!==r&&(c(n),l(s))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=o.indexOf(e.currentTarget)+1;n=o[t]??o[0];break}case"ArrowLeft":{const t=o.indexOf(e.currentTarget)-1;n=o[t]??o[o.length-1];break}}n?.focus()};return(0,y.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":t},n),children:a.map((e=>{let{value:n,label:t,attributes:i}=e;return(0,y.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>o.push(e),onKeyDown:u,onClick:d,...i,className:(0,s.A)("tabs__item",j.tabItem,i?.className,{"tabs__item--active":r===n}),children:t??n},n)}))})}function b(e){let{lazy:n,children:t,selectedValue:s}=e;const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===s));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return(0,y.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function v(e){const n=x(e);return(0,y.jsxs)("div",{className:(0,s.A)("tabs-container",j.tabList),children:[(0,y.jsx)(g,{...e,...n}),(0,y.jsx)(b,{...e,...n})]})}function w(e){const n=(0,m.A)();return(0,y.jsx)(v,{...e,children:u(e.children)},String(n))}function I(e){let{children:n}=e;return(0,y.jsx)(w,{groupID:"sdk",queryString:"sdk",defaultValue:"typescript",values:[{label:"Typescript SDK",value:"typescript"},{label:"Python SDK",value:"python"}],children:n})}},74169:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>a});var r=t(79474);const s={},i=r.createContext(s);function l(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);