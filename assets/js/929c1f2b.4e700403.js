(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[612],{2277:(e,n,i)=>{"use strict";i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>h});var t=i(11527),s=i(63883),a=i(3643),r=i(86117);const l={},d="Prisma",o={id:"reference/runtimes/prisma/index",title:"Prisma",description:"Prisma is a database ORM runtime that enables to query many different databases. It enables to create, read, update and delete data with a developer-friendly API. This runtime is included within the typegate and is compatible with the following databases:",source:"@site/docs/reference/runtimes/prisma/index.mdx",sourceDirName:"reference/runtimes/prisma",slug:"/reference/runtimes/prisma/",permalink:"/docs/reference/runtimes/prisma/",draft:!1,unlisted:!1,editUrl:"https://github.com/metatypedev/metatype/tree/main/website/docs/reference/runtimes/prisma/index.mdx",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"HTTP/REST",permalink:"/docs/reference/runtimes/http/"},next:{title:"Python",permalink:"/docs/reference/runtimes/python/"}},c={},h=[{value:"Prisma runtime",id:"prisma-runtime",level:2},{value:"Usage",id:"usage",level:2},{value:"Raw query",id:"raw-query",level:3},{value:"Models",id:"models",level:2},{value:"Relationships",id:"relationships",level:2},{value:"One-to-one relationships",id:"one-to-one-relationships",level:3},{value:"One-to-many relationships",id:"one-to-many-relationships",level:3},{value:"Many-to-many relationships",id:"many-to-many-relationships",level:3},{value:"Link",id:"link",level:3},{value:"Generators",id:"generators",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"prisma",children:"Prisma"}),"\n",(0,t.jsx)(n.p,{children:"Prisma is a database ORM runtime that enables to query many different databases. It enables to create, read, update and delete data with a developer-friendly API. This runtime is included within the typegate and is compatible with the following databases:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"PostgreSQL"}),"\n",(0,t.jsx)(n.li,{children:"MySQL"}),"\n",(0,t.jsx)(n.li,{children:"MariaDB"}),"\n",(0,t.jsx)(n.li,{children:"SQLite (however, SQLite is unlikely to be used with Metatype as it cannot be distributed easily)"}),"\n",(0,t.jsx)(n.li,{children:"AWS Aurora"}),"\n",(0,t.jsx)(n.li,{children:"AWS Aurora Serverless"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft SQL Server"}),"\n",(0,t.jsx)(n.li,{children:"Azure SQL"}),"\n",(0,t.jsx)(n.li,{children:"MongoDB"}),"\n",(0,t.jsx)(n.li,{children:"CockroachDB"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The exact supported version can be found on their ",(0,t.jsx)(n.a,{href:"https://www.prisma.io/docs/reference/database-reference/supported-databases",children:"documentation"}),". Some databases may not have some specific behaviors and features support. The precise details are also available in ",(0,t.jsx)(n.a,{href:"https://www.prisma.io/docs/reference/database-reference/database-features",children:"this page"}),"."]}),"\n",(0,t.jsx)(n.h1,{id:"your-first-api",children:"Your first API"}),"\n",(0,t.jsx)(n.p,{children:"Getting random data is great, but having some input variables and meaningful output is even better. The random runtime is usually used to quickly draft and iterate on an API prototype. Once the interface feels efficient and well-designed, it's time to move another runtime backed by some storage."}),"\n",(0,t.jsx)(n.admonition,{title:"Please share your feedback",type:"tip",children:(0,t.jsxs)(n.p,{children:['You can raise issues, suggest improvements, ask questions and share your feedback using comments below \u2193, using private messages with the "Help, Feedback & Roadmap" button on the right \u2192 or directly using the ',(0,t.jsx)(n.a,{href:"https://github.com/metatypedev/metatype/discussions",children:"GitHub discussions"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"prisma-runtime",children:"Prisma runtime"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://www.prisma.io/",children:"Prisma"}),' is a "Next-generation Node.js and Typescript ORM" supporting PostgreSQL, MySQL/MariaDB, SQLite, MongoDB, CockroachDB and Microsoft SQL Server. It is one of the main runtimes provided by Metatype and doesn\'t require any additional installation.']}),"\n",(0,t.jsxs)(n.p,{children:["Go ahead and update ",(0,t.jsx)(n.code,{children:"typegraph.py"})," with the highlighted lines below:"]}),"\n",(0,t.jsx)(a.Z,{typegraph:"database",python:i(16451),query:i(79455)}),"\n",(0,t.jsx)(n.p,{children:"A few things to note on the changes:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["You can import runtimes from ",(0,t.jsx)(n.code,{children:"typegraph.runtime.Y"})," or ",(0,t.jsx)(n.code,{children:"typegraph.providers.X.runtimes.Y"})," for non-core providers."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"config"})," method allows specifying runtime specific attributes. In this case, ",(0,t.jsx)(n.code,{children:"id"})," shall be automatically set and incremented by the database."]}),"\n",(0,t.jsx)(n.li,{children:"Types get generated names unless you manually specify them. You can find the exact names in the playground documentation. Here you want to have a human friendly name as it will also be the name of the table in your database."}),"\n",(0,t.jsx)(n.li,{children:"Runtimes often come with some sugar syntax to generate types and avoid manipulating materializers directly. A corresponding declaration would have looked like this:"}),"\n"]}),"\n",(0,t.jsx)(r.Z,{language:"python",children:i(88206).content}),"\n",(0,t.jsxs)(n.p,{children:["In order to use the Prisma runtime, you need to add a new environment variable. Runtimes don't take raw secrets, but instead a secret key used to look up environment variables named under the format ",(0,t.jsx)(n.code,{children:"TG_[typegraph name]_[key]"}),". You can either add it in your ",(0,t.jsx)(n.code,{children:"metatype.yml"})," (recommended) or in your ",(0,t.jsx)(n.code,{children:"compose.yml"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"$ cat metatype.yml\ntypegates:\n  dev:\n    # ..\n    env:\n# highlight-next-line\n      TG_DATABASE_POSTGRES_CONN: postgresql://postgres:password@postgres:5432/db\n\n$ meta dev\n"})}),"\n",(0,t.jsx)(n.p,{children:"And now, you can iteratively continue to improve your interface, running migrations and having data stored inside your database."}),"\n",(0,t.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'with TypeGraph("prisma-runtime-example") as g:\n    db = PrismaRuntime("main_db", "DB_CONNECTION")\n\n    user = t.struct(\n        {\n            "id": t.uuid().config("id", "auto"),\n            "email": t.email(),\n        }\n    )\n\n    g.expose(\n        createUser=db.create(user).add_policy(public)\n    )\n'})}),"\n",(0,t.jsx)(n.h3,{id:"raw-query",children:"Raw query"}),"\n",(0,t.jsx)(n.p,{children:"Generate a raw SQL query operation on the runtime"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'db = PrismaRuntime("my-app", "POSTGRES")\ng.expose(\n    countUsers=db.raw_query(\n        "SELECT COUNT(*) as total FROM User",\n        t.struct({}),\n        t.list(t.struct({"total": t.integer()}))\n    )\n)\n'})}),"\n",(0,t.jsx)(n.p,{children:"Generate a raw SQL query operation without return"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'db = PrismaRuntime("my-app", "POSTGRES")\ng.expose(\n    setActive=db.raw_execute(\n        "UPDATE User SET active = TRUE WHERE id=${id}",\n        t.struct({"id": t.uuid()}),\n        effect=effects.update()\n    ),\n)\n'})}),"\n",(0,t.jsx)(n.h2,{id:"models",children:"Models"}),"\n",(0,t.jsxs)(n.p,{children:["Any ",(0,t.jsx)(n.code,{children:"t.struct"})," that is passed to a generator of a ",(0,t.jsx)(n.code,{children:"PrismaRuntime"}),"\ndefines a model. Models must have an ID field specified by the ",(0,t.jsx)(n.code,{children:'"id"'})," config."]}),"\n",(0,t.jsx)(n.p,{children:"Here is the list of all the available configs for model fields:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Config"}),(0,t.jsx)(n.th,{children:"Effect"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"id"})}),(0,t.jsx)(n.td,{children:"defines the field ID for the model (a.k.a. primary key)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"auto"})}),(0,t.jsxs)(n.td,{children:["the value of this field can be auto generated; supported for ",(0,t.jsx)(n.code,{children:"t.integer()"})," (auto-increment) and ",(0,t.jsx)(n.code,{children:"t.uuid()"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"unique"})}),(0,t.jsx)(n.td,{children:"make this field unique among all instances of the model"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"relationships",children:"Relationships"}),"\n",(0,t.jsxs)(n.p,{children:["Relationship fields must be defined on both sides of the relationship.\nA relationship is always defined for ",(0,t.jsx)(n.code,{children:"t.struct"})," types and ",(0,t.jsx)(n.code,{children:"t.optional"})," or\n",(0,t.jsx)(n.code,{children:"t.list"})," of ",(0,t.jsx)(n.code,{children:"t.struct"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Relationships can also be defined implicitly using the ",(0,t.jsx)(n.a,{href:"#link",children:(0,t.jsx)(n.code,{children:"link"})})," instance method\nof ",(0,t.jsx)(n.code,{children:"PrismaRuntime"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'runtime = PrismaRuntime("example", "POSTGRES")\n\nuser = t.struct(\n    {\n        "id": t.uuid().config("id", "auto"),\n        "email": t.email().config("unique"),\n        "posts": t.list(g("Post")),\n    }\n).named("User")\n\npost = t.struct(\n    {\n        "id": t.uuid().config("id", "auto"),\n        "title": t.string(),\n        "author": g("User"),\n    }\n).named("Post")\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"PrismaRuntime"})," supports two kinds of relationship between models."]}),"\n",(0,t.jsx)(n.h3,{id:"one-to-one-relationships",children:"One-to-one relationships"}),"\n",(0,t.jsx)(n.p,{children:"A one-to-one relationship must be in one of these two variants."}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Cardinality"}),(0,t.jsx)(n.th,{children:"Field type in Model1"}),(0,t.jsx)(n.th,{children:"Field type in Model2"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1..1 \u2194 0..1"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'g("Model2")'})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'g("Model1").optional()'})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"0..1 \u2194 0..1"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'g("Model2").optional()'})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'g("Model1").optional()'})})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"For the optional (0..1 \u2194 0..1) one-to-one relationship,\nyou need to indicate on which field/model the foreign key will be by:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["wrapping the type in a ",(0,t.jsx)(n.a,{href:"#link",children:(0,t.jsx)(n.code,{children:"runtime.link(.)"})})," with ",(0,t.jsx)(n.code,{children:"fkey=True"}),":\n",(0,t.jsx)(n.code,{children:'runtime.link(g("Model2").optional(), fkey=True)'}),";",(0,t.jsx)("br",{})]}),"\n",(0,t.jsxs)(n.li,{children:["or adding ",(0,t.jsx)(n.code,{children:'.config("unique")'}),": ",(0,t.jsx)(n.code,{children:'g("Model2").optional().config("unique")'}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"one-to-many-relationships",children:"One-to-many relationships"}),"\n",(0,t.jsx)(n.p,{children:"A one-to-many relationship must be in one of these two variants."}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Cardinality"}),(0,t.jsx)(n.th,{children:"Field type in Model1"}),(0,t.jsx)(n.th,{children:"Field type in Model2"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"1..1 \u2194 0..n"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'g("Model2")'})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'t.list(g("Model1"))'})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"0..1 \u2194 0..n"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'g("Model2").optional()'})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:'t.list(g("Model1"))'})})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"many-to-many-relationships",children:"Many-to-many relationships"}),"\n",(0,t.jsx)(n.p,{children:"Many-to-many relationships must be modelled explicitly using a join model."}),"\n",(0,t.jsx)(n.h3,{id:"link",children:"Link"}),"\n",(0,t.jsxs)(n.p,{children:["Explicitly declare a relationship between models. The return value of\nthis function shall be the type of a property of a ",(0,t.jsx)(n.code,{children:"t.struct"})," that\ndefines a model. If the other end of the relationship is also defined using ",(0,t.jsx)(n.code,{children:"link"}),",\nboth links must have the same name."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'runtime = PrismaRuntime("example", "POSTGRES")\n\nuser = t.struct(\n    {\n        "id": t.uuid().config("id", "auto"),\n        "email": t.email().config("unique"),\n        "posts": runtime.link(t.list(g("Post")), "postAuthor"),\n    }\n).named("User")\n\npost = t.struct(\n    {\n        "id": t.uuid().config("id", "auto"),\n        "title": t.string(),\n        "author": runtime.link(g("User"), "postAuthor"),\n    }\n).named("Post")\n'})}),"\n",(0,t.jsx)(n.h2,{id:"generators",children:"Generators"}),"\n",(0,t.jsxs)(n.p,{children:["Generators are instance methods of ",(0,t.jsx)(n.code,{children:"PrismaRuntime"})," that can be used\nto generate a ",(0,t.jsx)(n.code,{children:"t.func"})," that represents a specific operation on a specific\nmodel of the runtime. They match to the model queries defined for the\n",(0,t.jsx)(n.a,{href:"https://www.prisma.io/docs/reference/api-reference/prisma-client-reference",children:"prisma client API"}),".\nfor the type of the input ",(0,t.jsx)(n.code,{children:"t.struct"})," and the return type."]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'with TypeGraph("prisma-runtime-example") as g:\n    db = PrismaRuntime("main_db", "DB_CONNECTION")\n\n    user = t.struct(\n        {\n            "id": t.uuid().config("id", "auto"),\n            "email": t.email(),\n        }\n    )\n\n    g.expose(\n        createUser=db.create(user).add_policy(public),\n        findUser=db.find(user).add_policy(public),\n        findManyUsers=db.find_many(user).add_policy(public),\n    )\n'})}),"\n",(0,t.jsx)(n.p,{children:"Here is a list of all available generators:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"find_unique"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"find_first"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"find_many"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"create"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"update"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"upsert"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"delete"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"delete_many"})}),"\n"]})]})}function m(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},46153:(e,n,i)=>{"use strict";i.d(n,{r:()=>s});i(50959);var t=i(11527);function s(e){let{name:n,choices:i,choice:s,onChange:a,className:r}=e;return(0,t.jsx)("ul",{className:`pl-0 m-0 list-none w-full ${r??""}`,children:Object.entries(i).map((e=>{let[i,r]=e;return(0,t.jsx)("li",{className:"inline-block rounded-md overflow-clip mr-1",children:(0,t.jsx)("div",{children:(0,t.jsxs)("label",{className:"cursor-pointer",children:[(0,t.jsx)("input",{type:"radio",name:n,value:i,checked:i===s,onChange:()=>a(i),className:"hidden peer"}),(0,t.jsx)("div",{className:"px-3 py-1 bg-slate-100 peer-checked:bg-metared peer-checked:text-white",children:r})]})})},i)}))})}},48893:(e,n,i)=>{"use strict";i.d(n,{Z:()=>g});var t=i(50959),s=i(52691),a=i(45197),r=i(14899),l=i(86117),d=i(7587),o=i(33961),c=i(11527);const h=e=>{e.getWrapperElement().closest(".graphiql-editor").style.height=`${e.doc.height}px`};function u(e){const{queryEditor:n,variableEditor:i,headerEditor:s}=(0,o._i)({nonNull:!0}),[a,r]=(0,t.useState)(e.defaultTab),l=(0,o.Xd)({onCopyQuery:e.onCopyQuery}),d=(0,o.fE)();return(0,t.useEffect)((()=>{i&&h(i)}),[a,i]),(0,t.useEffect)((()=>{s&&h(s)}),[a,s]),(0,t.useEffect)((()=>{n&&(n.setOption("lineNumbers",!1),n.setOption("extraKeys",{"Alt-G":()=>{n.replaceSelection("@")}}),n.setOption("gutters",[]),n.on("change",h),h(n))}),[n]),(0,t.useEffect)((()=>{i&&(i.setOption("lineNumbers",!1),i.setOption("gutters",[]),i.on("change",h))}),[i]),(0,t.useEffect)((()=>{s&&(s.setOption("lineNumbers",!1),s.setOption("gutters",[]),s.on("change",h))}),[s]),(0,c.jsx)(o.u.Provider,{children:(0,c.jsxs)("div",{className:"graphiql-editors",children:[(0,c.jsx)("section",{className:"graphiql-query-editor shadow-sm","aria-label":"Query Editor",children:(0,c.jsxs)("div",{className:"graphiql-query-editor-wrapper",children:[(0,c.jsx)(o.WK,{editorTheme:e.editorTheme,keyMap:e.keyMap,onCopyQuery:e.onCopyQuery,onEdit:e.onEditQuery,readOnly:e.readOnly}),(0,c.jsxs)("div",{className:"graphiql-toolbar",role:"toolbar","aria-label":"Editor Commands",children:[(0,c.jsx)(o._8,{}),(0,c.jsx)(o.wC,{onClick:()=>d(),label:"Prettify query (Shift-Ctrl-P)",children:(0,c.jsx)(o.Kt,{className:"graphiql-toolbar-icon","aria-hidden":"true"})}),(0,c.jsx)(o.wC,{onClick:()=>l(),label:"Copy query (Shift-Ctrl-C)",children:(0,c.jsx)(o.TI,{className:"graphiql-toolbar-icon","aria-hidden":"true"})})]})]})}),e.noTool?null:(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("div",{className:"graphiql-editor-tools p-0 text-sm ",children:(0,c.jsxs)("div",{className:"graphiql-editor-tools-tabs",children:[(0,c.jsx)("div",{className:("variables"===a?"text-slate-800":"")+" p-2 hover:text-slate-800 cursor-pointer",onClick:()=>{r("variables"===a?"":"variables")},children:"Variables"}),(0,c.jsx)("div",{className:("headers"===a?"text-slate-800":"")+" p-2 hover:text-slate-800 cursor-pointer",onClick:()=>{r("headers"===a?"":"headers")},children:"Headers"})]})}),(0,c.jsxs)("section",{className:"graphiql-editor-tool "+(a&&a.length>0?"pt-0":"hidden p-0"),"aria-label":"variables"===a?"Variables":"Headers",children:[(0,c.jsx)(o.hF,{editorTheme:e.editorTheme,isHidden:"variables"!==a,keyMap:e.keyMap,onEdit:e.onEditVariables,readOnly:e.readOnly}),(0,c.jsx)(o.LA,{editorTheme:e.editorTheme,isHidden:"headers"!==a,keyMap:e.keyMap,onEdit:e.onEditHeaders,readOnly:e.readOnly})]})]})]})})}class m{constructor(){this.map=new Map,this.length=0}getItem(e){return this.map.get(e)}setItem(e,n){this.map.has(e)||(this.length+=1),this.map.set(e,n)}removeItem(e){this.map.has(e)&&(this.length-=1),this.map.delete(e)}clear(){this.length=0,this.map.clear()}}var p=i(46153);function x(){return(0,o.JB)({nonNull:!0}).isFetching?(0,c.jsx)(o.$j,{}):null}const j={typegraph:"Typegraph",playground:"Playground"};function f(e){let{typegraph:n,query:i,code:a,codeLanguage:h,codeFileUrl:f,headers:g={},variables:y={},tab:b="",noTool:v=!1,defaultMode:k=null}=e;const{siteConfig:{customFields:{tgUrl:w}}}=(0,r.Z)(),N=(0,t.useMemo)((()=>new m),[]),S=(0,t.useMemo)((()=>(0,s.nq)({url:`${w}/${n}`})),[]),[T,O]=(0,t.useState)(k);return(0,c.jsxs)("div",{className:"@container miniql mb-5",children:[k?(0,c.jsx)(p.r,{name:"mode",choices:j,choice:T,onChange:O,className:"mb-2"}):null,(0,c.jsx)(o.j$,{fetcher:S,defaultQuery:i.loc?.source.body.trim(),defaultHeaders:JSON.stringify(g),shouldPersistHeaders:!0,variables:JSON.stringify(y),storage:N,children:(0,c.jsxs)("div",{className:(k?"":"md:grid @2xl:grid-cols-2")+" gap-2 w-full order-first",children:[k&&"typegraph"!==T?null:(0,c.jsxs)("div",{className:" bg-slate-100 rounded-lg flex flex-col mb-2 md:mb-0",children:[f?(0,c.jsxs)("div",{className:"p-2 text-xs font-light",children:["See/edit full code on"," ",(0,c.jsx)(d.Z,{href:`https://github.com/metatypedev/metatype/blob/main/${f}`,children:f})]}):null,a?(0,c.jsx)(l.Z,{language:h,wrap:!0,className:"flex-1",children:a}):null]}),k&&"playground"!==T?null:(0,c.jsxs)("div",{className:"flex flex-col graphiql-container",children:[(0,c.jsx)("div",{className:"flex-1 graphiql-session",children:(0,c.jsx)(u,{defaultTab:b,noTool:v})}),(0,c.jsxs)("div",{className:"flex-auto graphiql-response min-h-[200px] p-2 mt-2 bg-slate-100 rounded-lg",children:[(0,c.jsx)(x,{}),(0,c.jsx)(o.iB,{})]})]})]})})]})}function g(e){return(0,c.jsx)(a.Z,{fallback:(0,c.jsx)("div",{children:"Loading..."}),children:()=>(0,c.jsx)(f,{...e})})}},3643:(e,n,i)=>{"use strict";i.d(n,{Z:()=>a});var t=i(48893),s=(i(50959),i(11527));function a(e){let{python:n,...i}=e;return(0,s.jsx)(t.Z,{code:n.content,codeLanguage:"python",codeFileUrl:n.path,...i})}},79455:e=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"A"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"create_message"},arguments:[{kind:"Argument",name:{kind:"Name",value:"data"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"title"},value:{kind:"StringValue",value:"Hello World",block:!1}},{kind:"ObjectField",name:{kind:"Name",value:"body"},value:{kind:"StringValue",value:"This is a message",block:!1}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"B"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"list_messages"},arguments:[{kind:"Argument",name:{kind:"Name",value:"where"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"title"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"equals"},value:{kind:"StringValue",value:"Hello World",block:!1}}]}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"body"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:251}};n.loc.source={body:'mutation A {\n  create_message(\n    data: {\n      # id is autogenerated\n      title: "Hello World"\n      body: "This is a message"\n    }\n  ) {\n    id\n  }\n}\n\nquery B {\n  list_messages(where: { title: { equals: "Hello World" } }) {\n    id\n    body\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,n){if("FragmentSpread"===e.kind)n.add(e.name.value);else if("VariableDefinition"===e.kind){var t=e.type;"NamedType"===t.kind&&n.add(t.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,n)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,n)})),e.definitions&&e.definitions.forEach((function(e){i(e,n)}))}var t={};function s(e,n){for(var i=0;i<e.definitions.length;i++){var t=e.definitions[i];if(t.name&&t.name.value==n)return t}}function a(e,n){var i={kind:e.kind,definitions:[s(e,n)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var a=t[n]||new Set,r=new Set,l=new Set;for(a.forEach((function(e){l.add(e)}));l.size>0;){var d=l;l=new Set,d.forEach((function(e){r.has(e)||(r.add(e),(t[e]||new Set).forEach((function(e){l.add(e)})))}))}return r.forEach((function(n){var t=s(e,n);t&&i.definitions.push(t)})),i}n.definitions.forEach((function(e){if(e.name){var n=new Set;i(e,n),t[e.name.value]=n}})),e.exports=n,e.exports.A=a(n,"A"),e.exports.B=a(n,"B")},16451:e=>{e.exports={content:'# highlight-next-line\nfrom typegraph.providers.prisma import PrismaRuntime\n\n\n@typegraph(\n    allow_origin=[\n      "https://metatype.dev",\n      "http://localhost:3000",\n    ],\n  ),\n)\ndef database(g: Graph):\n  db = PrismaRuntime("database", "POSTGRES_CONN")\n  public = Policy.public()\n\n  message = t.struct(\n    {\n      # highlight-next-line\n      "id": t.integer(as_id=True, config=["auto"]),\n      "title": t.string(),\n      "body": t.string(),\n    },\n    # highlight-next-line\n    name="message",\n  )\n\n  g.expose(\n    public,\n    # highlight-next-line\n    create_message=db.create(message),\n    list_messages=db.find_many(message),\n  )',path:"website/docs/reference/runtimes/prisma/database.py"}},88206:e=>{e.exports={content:"",path:"website/docs/reference/runtimes/prisma/prisma-no-sugar.py"}}}]);