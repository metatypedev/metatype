(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7525],{73198:(e,t,a)=>{"use strict";a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var n=a(13274),i=a(25618),s=a(89009);const o={},r="Programmable API gateway",l={id:"programmable-api-gateway/index",title:"Programmable API gateway",description:"A programmable API gateway is an API gateway that provides a customizable framework for developers to create and deploy custom logic and policies for incoming requests and outgoing responses. Unlike traditional API gateways that provide a fixed set of features and policies, programmable API gateways offer a more flexible and extensible approach to managing APIs.",source:"@site/use-cases/programmable-api-gateway/index.mdx",sourceDirName:"programmable-api-gateway",slug:"/programmable-api-gateway/",permalink:"/use-cases/programmable-api-gateway/",draft:!1,unlisted:!1,editUrl:"https://github.com/metatypedev/metatype/tree/main/website/use-cases/programmable-api-gateway/index.mdx",tags:[],version:"current",frontMatter:{},sidebar:"useCases",previous:{title:"ORM for the edge",permalink:"/use-cases/orm-for-the-edge/"}},c={},d=[{value:"Case study",id:"case-study",level:2},{value:"Metatype&#39;s solution",id:"metatypes-solution",level:2}];function p(e){const t={h1:"h1",h2:"h2",img:"img",p:"p",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"programmable-api-gateway",children:"Programmable API gateway"}),"\n",(0,n.jsx)(t.p,{children:"A programmable API gateway is an API gateway that provides a customizable framework for developers to create and deploy custom logic and policies for incoming requests and outgoing responses. Unlike traditional API gateways that provide a fixed set of features and policies, programmable API gateways offer a more flexible and extensible approach to managing APIs."}),"\n",(0,n.jsx)(t.h2,{id:"case-study",children:"Case study"}),"\n",(0,n.jsx)("div",{className:"text-center md:float-right p-8",children:(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:a(18826).A+""})})}),"\n",(0,n.jsx)(t.p,{children:"Suppose that your company needs to implement various policies and logic to manage and secure its APIs, such as rate limiting, caching, and request/response transformations."}),"\n",(0,n.jsx)(t.p,{children:"To achieve this, the company can adopt a programmable API gateway that allows developers to create and deploy custom function to implement additional logic and policies for incoming requests and outgoing responses."}),"\n",(0,n.jsx)(t.p,{children:"It also provides a platform for the company to manage its API infrastructure more efficiently and flexibly. Developers can leverage existing libraries and frameworks to quickly build and deploy custom logic, reducing the time and effort required to develop and maintain the API gateway."}),"\n",(0,n.jsx)(t.h2,{id:"metatypes-solution",children:"Metatype's solution"}),"\n",(0,n.jsx)(t.p,{children:"Metatype provide a Python SDK for developers to create and deploy custom logic and policies, which can later be deployed to the gateway in a single command line. Importers can also be used to import existing API or logic definitions from other sources, such as OpenAPI, GraphQL, and gRPC."}),"\n",(0,n.jsx)(t.p,{children:"This enables developer to quickly build and deploy any update the API or the business logic without having to worry about the underlying infrastructure."}),"\n",(0,n.jsx)(s.A,{typegraph:"programmable-api-gateway",python:a(84223),typescript:a(72513),query:a(31627)})]})}function u(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(p,{...e})}):p(e)}},6381:(e,t,a)=>{"use strict";a.d(t,{m:()=>s});var n=a(79474),i=a(13274);function s(e){let{choices:t,choice:a,onChange:s,className:o,children:r}=e;const l=n.Children.toArray(r).map((e=>{if(!n.isValidElement(e)||!t[e.props?.value])throw new Error("ChoicePicker only accepts children with a value prop");return e})).find((e=>e.props?.value===a));return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("ul",{className:`pl-0 m-0 list-none text-sm ${o??""}`,children:Object.entries(t).map((e=>{let[t,n]=e;return(0,i.jsx)("li",{className:"inline-block rounded-md overflow-clip my-2 mr-2",children:(0,i.jsx)("div",{children:(0,i.jsxs)("label",{className:"cursor-pointer",children:[(0,i.jsx)("input",{type:"radio",value:t,checked:t===a,onChange:()=>s(t),className:"hidden peer"}),(0,i.jsx)("div",{className:"px-3 py-1 bg-slate-100 peer-checked:bg-metared peer-checked:text-white",children:n})]})})},t)}))}),l]})}},40150:(e,t,a)=>{"use strict";a.d(t,{A:()=>v});var n=a(79474),i=a(355),s=a(28331),o=a(54629),r=a(81628),l=a(56617),c=a(61607),d=a(13274);const p=e=>{e.getWrapperElement().closest(".graphiql-editor").style.height=`${e.doc.height}px`};function u(e){const{queryEditor:t,variableEditor:a,headerEditor:i}=(0,c.mi)({nonNull:!0}),[s,o]=(0,n.useState)(e.defaultTab),r=(0,c.xb)({onCopyQuery:e.onCopyQuery}),l=(0,c.Ln)();return(0,n.useEffect)((()=>{a&&p(a)}),[s,a]),(0,n.useEffect)((()=>{i&&p(i)}),[s,i]),(0,n.useEffect)((()=>{t&&(t.setOption("lineNumbers",!1),t.setOption("extraKeys",{"Alt-G":()=>{t.replaceSelection("@")}}),t.setOption("gutters",[]),t.on("change",p),p(t))}),[t]),(0,n.useEffect)((()=>{a&&(a.setOption("lineNumbers",!1),a.setOption("gutters",[]),a.on("change",p))}),[a]),(0,n.useEffect)((()=>{i&&(i.setOption("lineNumbers",!1),i.setOption("gutters",[]),i.on("change",p))}),[i]),(0,d.jsx)(c.m_.Provider,{children:(0,d.jsxs)("div",{className:"graphiql-editors",children:[(0,d.jsx)("section",{className:"graphiql-query-editor ","aria-label":"Query Editor",children:(0,d.jsxs)("div",{className:"graphiql-query-editor-wrapper",children:[(0,d.jsx)(c.wY,{editorTheme:e.editorTheme,keyMap:e.keyMap,onCopyQuery:e.onCopyQuery,onEdit:e.onEditQuery,readOnly:e.readOnly}),(0,d.jsxs)("div",{className:"graphiql-toolbar",role:"toolbar","aria-label":"Editor Commands",children:[(0,d.jsx)(c.cl,{}),(0,d.jsx)(c.IB,{onClick:()=>l(),label:"Prettify query (Shift-Ctrl-P)",children:(0,d.jsx)(c.RG,{className:"graphiql-toolbar-icon","aria-hidden":"true"})}),(0,d.jsx)(c.IB,{onClick:()=>r(),label:"Copy query (Shift-Ctrl-C)",children:(0,d.jsx)(c.Td,{className:"graphiql-toolbar-icon","aria-hidden":"true"})})]})]})}),e.noTool?null:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"graphiql-editor-tools p-0 text-sm ",children:(0,d.jsxs)("div",{className:"graphiql-editor-tools-tabs",children:[(0,d.jsx)("div",{className:("variables"===s?"text-slate-800":"")+" p-2 hover:text-slate-800 cursor-pointer",onClick:()=>{o("variables"===s?"":"variables")},children:"Variables"}),(0,d.jsx)("div",{className:("headers"===s?"text-slate-800":"")+" p-2 hover:text-slate-800 cursor-pointer",onClick:()=>{o("headers"===s?"":"headers")},children:"Headers"})]})}),(0,d.jsxs)("section",{className:"graphiql-editor-tool "+(s&&s.length>0?"pt-0":"hidden p-0"),"aria-label":"variables"===s?"Variables":"Headers",children:[(0,d.jsx)(c.G0,{editorTheme:e.editorTheme,isHidden:"variables"!==s,keyMap:e.keyMap,onEdit:e.onEditVariables,readOnly:e.readOnly}),(0,d.jsx)(c.B4,{editorTheme:e.editorTheme,isHidden:"headers"!==s,keyMap:e.keyMap,onEdit:e.onEditHeaders,readOnly:e.readOnly})]})]})]})})}class m{constructor(){this.map=new Map,this.length=0}getItem(e){return this.map.get(e)}setItem(e,t){this.map.has(e)||(this.length+=1),this.map.set(e,t)}removeItem(e){this.map.has(e)&&(this.length-=1),this.map.delete(e)}clear(){this.length=0,this.map.clear()}}var h=a(6381),g=a(62607),f=a(88341);function y(){return(0,c.Vm)({nonNull:!0}).isFetching?(0,d.jsx)(c.y$,{}):null}const b={typegraph:"Typegraph",playground:"Playground"};function x(e){let{typegraph:t,query:a,code:s,headers:p={},variables:x={},panel:v="",noTool:j=!1,defaultMode:w=null}=e;const{siteConfig:{customFields:{tgUrl:k}}}=(0,o.A)(),N=(0,n.useMemo)((()=>new m),[]),P=(0,n.useMemo)((()=>(0,i.a5)({url:`${k}/${t}`})),[]),[A,q]=(0,n.useState)(w),[S,C]=(0,g.e)();return console.log(s),(0,d.jsxs)("div",{className:"@container miniql mb-4",children:[w?(0,d.jsx)(h.m,{choices:b,choice:A,onChange:q}):null,(0,d.jsx)(c.ql,{fetcher:P,defaultQuery:a.loc?.source.body.trim(),defaultHeaders:JSON.stringify(p),shouldPersistHeaders:!0,variables:JSON.stringify(x),storage:N,children:(0,d.jsxs)("div",{className:(w?"":"md:grid @2xl:grid-cols-2")+" gap-2 w-full order-first",children:[w&&"typegraph"!==A?null:(0,d.jsx)("div",{className:" bg-slate-100 rounded-lg flex flex-col mb-2 md:mb-0 relative",children:(0,d.jsx)(h.m,{choices:{typescript:"Typescript",python:"Python"},choice:S,onChange:C,className:"ml-2",children:s?.map((e=>(0,d.jsxs)(f.A,{value:e.codeLanguage,children:[(0,d.jsxs)(l.A,{href:`https://github.com/metatypedev/metatype/blob/main/${e?.codeFileUrl}`,className:"absolute top-0 right-0 m-2 p-1",children:[e?.codeFileUrl?.split("/").pop()," \u2197"]}),(0,d.jsx)(r.A,{language:e?.codeLanguage,wrap:!0,className:"flex-1",children:e.content})]},e.codeLanguage)))})}),w&&"playground"!==A?null:(0,d.jsxs)("div",{className:"flex flex-col graphiql-container",children:[(0,d.jsx)("div",{className:"flex-1 graphiql-session",children:(0,d.jsx)(u,{defaultTab:v,noTool:j})}),(0,d.jsxs)("div",{className:"flex-auto graphiql-response min-h-[200px] p-2 mt-2 bg-slate-100 rounded-lg",children:[(0,d.jsx)(y,{}),(0,d.jsx)(c.ny,{})]})]})]})})]})}function v(e){return(0,d.jsx)(s.A,{fallback:(0,d.jsx)("div",{children:"Loading..."}),children:()=>(0,d.jsx)(x,{...e})})}},89009:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});var n=a(40150),i=(a(79474),a(13274));function s(e){let{python:t,typescript:a,...s}=e;const o=[t&&{content:t.content,codeLanguage:"python",codeFileUrl:t.path},a&&{content:a.content,codeLanguage:"typescript",codeFileUrl:a.path}].filter((e=>!!e));return(0,i.jsx)(n.A,{code:0==o.length?void 0:o,...s})}},62607:(e,t,a)=>{"use strict";a.d(t,{e:()=>u});var n=a(52264),i=a(52116),s=a(38710),o=a(17604),r=a(79474);const l="sdk",c=(0,o.N)(),d=(0,n.eU)((e=>e(c).searchParams?.get(l)),((e,t,a)=>{const n=e(c).searchParams??new URLSearchParams;n.set(l,a),t(c,(e=>({...e,searchParams:n})))})),p=(0,s.tG)(l,"typescript",(0,s.KU)((()=>sessionStorage)));function u(){const[e,t]=(0,i.fp)(d),[a,n]=(0,i.fp)(p);(0,r.useEffect)((()=>{e&&e!==a&&n(e)}),[e,n]);const s=(0,r.useCallback)((e=>{t(e),n(e)}),[t,n]);return[e??a,s]}},31627:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"A"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"static_a"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"foo"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"B"},variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"static_b"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"foo"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:75}};t.loc.source={body:"query A {\n  static_a {\n    foo\n  }\n}\n\nquery B {\n  static_b {\n    foo\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function a(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){a(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){a(e,t)})),e.definitions&&e.definitions.forEach((function(e){a(e,t)}))}var n={};function i(e,t){for(var a=0;a<e.definitions.length;a++){var n=e.definitions[a];if(n.name&&n.name.value==t)return n}}function s(e,t){var a={kind:e.kind,definitions:[i(e,t)]};e.hasOwnProperty("loc")&&(a.loc=e.loc);var s=n[t]||new Set,o=new Set,r=new Set;for(s.forEach((function(e){r.add(e)}));r.size>0;){var l=r;r=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){r.add(e)})))}))}return o.forEach((function(t){var n=i(e,t);n&&a.definitions.push(n)})),a}t.definitions.forEach((function(e){if(e.name){var t=new Set;a(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.A=s(t,"A"),e.exports.B=s(t,"B")},18826:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});const n=a.p+"assets/images/image.drawio-c3feec9409b941440f13260d6a23c2d4.svg"},84223:e=>{e.exports={content:'@typegraph(\n    allow_origin=["https://metatype.dev", "http://localhost:3000"]\n  ),\n)\ndef programmable_api_gateway(g: Graph):\n  deno = DenoRuntime()\n\n  public = Policy.public()\n  roulette_access = deno.policy(\n    "roulette", "() => Math.random() < 0.5"\n  )\n\n  my_api_format = """\n  static_a:\n    access: roulette_access\n    foo: rab\n  static_b:\n    access: public\n    foo: bar\n  """\n\n  for field, static_vals in yaml.safe_load(my_api_format).items():\n    g.expose(\n      public\n      if static_vals.pop("access") == "public"\n      else roulette_access,\n      **{\n        field: deno.static(\n          t.struct({"foo": t.string()}), static_vals\n        )\n      },\n    )',path:"examples/typegraphs/programmable-api-gateway.py"}},72513:e=>{e.exports={content:'await typegraph({\n  name: "programmable-api-gateway",\n}, (g) => {\n  const deno = new DenoRuntime();\n\n  const pub = Policy.public();\n  const roulette_access = deno.policy("roulette", "() => Math.random() < 0.5");\n\n    "static_a": { foo: "rab", access: "roulette_access" },\n    "static_b": { foo: "bar", access: "public" },\n  };\n\n  for (const [k, static_vals] of Object.entries(myApiFormat)) {\n    const policy = static_vals["access"] == "public" ? pub : roulette_access;\n    g.expose({\n      [k]: deno.static(t.struct({ "foo": t.string() }), {\n        foo: static_vals["foo"],\n      }),\n    }, policy);\n  }\n});',path:"examples/typegraphs/programmable-api-gateway.ts"}},25618:(e,t,a)=>{"use strict";a.d(t,{R:()=>o,x:()=>r});var n=a(79474);const i={},s=n.createContext(i);function o(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);