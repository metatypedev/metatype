(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2731],{88661:(e,t,a)=>{"use strict";a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var n=a(13274),s=a(99128),r=a(11640);const i={},o="Composable GraphQL server",l={id:"graphql-server/index",title:"Composable GraphQL server",description:"GraphQL is a query language for APIs that was developed by Facebook in 2012 and open-sourced in 2015. It provides a more efficient, powerful, and flexible alternative to REST APIs by allowing clients to request only the data they need and enabling servers to expose a schema that defines the available data and operations.",source:"@site/use-cases/graphql-server/index.mdx",sourceDirName:"graphql-server",slug:"/graphql-server/",permalink:"/use-cases/graphql-server/",draft:!1,unlisted:!1,editUrl:"https://github.com/metatypedev/metatype/tree/main/website/use-cases/graphql-server/index.mdx",tags:[],version:"current",frontMatter:{},sidebar:"useCases",previous:{title:"Cloud function runner",permalink:"/use-cases/faas-runner/"},next:{title:"IAM gateway",permalink:"/use-cases/iam-provider/"}},c={},d=[{value:"Case study",id:"case-study",level:2},{value:"Metatype&#39;s solution",id:"metatypes-solution",level:2}];function p(e){const t={h1:"h1",h2:"h2",img:"img",p:"p",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"composable-graphql-server",children:"Composable GraphQL server"}),"\n",(0,n.jsx)(t.p,{children:"GraphQL is a query language for APIs that was developed by Facebook in 2012 and open-sourced in 2015. It provides a more efficient, powerful, and flexible alternative to REST APIs by allowing clients to request only the data they need and enabling servers to expose a schema that defines the available data and operations."}),"\n",(0,n.jsx)(t.h2,{id:"case-study",children:"Case study"}),"\n",(0,n.jsx)("div",{className:"text-center md:float-right p-8",children:(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:a(59660).A+""})})}),"\n",(0,n.jsx)(t.p,{children:"Suppose you are building a subscription platform with a GraphQL API. You need to design a schema that accurately represents the available products, their attributes, and the operations that clients can perform, such as searching, filtering, and sorting."}),"\n",(0,n.jsx)(t.p,{children:"You also need to optimize the performance of complex queries that involve joining multiple data sources, such as products, categories, and user preferences. Additionally, you need to implement caching and pagination to improve the performance and scalability of your API."}),"\n",(0,n.jsx)(t.p,{children:"Finally, you need to ensure that your API is secure and implements appropriate authentication and authorization mechanisms to protect sensitive data and operations. Some challenges like the N+1 problem (when a single query results in multiple nested queries, each of which requires a separate database or API call) can also make the development of GraphQL resolver slow and complex to manage."}),"\n",(0,n.jsx)(t.h2,{id:"metatypes-solution",children:"Metatype's solution"}),"\n",(0,n.jsx)(t.p,{children:"Metatype's approach is to focus on schema design solely, and leave the GraphQL resolver implementation to the engine. By providing where the data is stored and how to access it, the queries are optimized by the engine to minimize the number of external API/database calls and to cache the results."}),"\n",(0,n.jsx)(t.p,{children:"This can be seen as a declarative GraphQL servers, where the server is orchestrated everything for you. Metatype also comes with pre-built functionalities like authentication, authorization, and rate limiting."}),"\n",(0,n.jsx)(r.A,{typegraph:"graphql-server",python:a(19017),typescript:a(42671),query:a(66509)})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(p,{...e})}):p(e)}},26787:(e,t,a)=>{"use strict";a.d(t,{A:()=>x});var n=a(79474),s=a(80126),r=a(8035),i=a(84221),o=a(80872),l=a(3649),c=a(34077),d=a(13274);const p=e=>{e.getWrapperElement().closest(".graphiql-editor").style.height=`${e.doc.height}px`};function h(e){const{queryEditor:t,variableEditor:a,headerEditor:s}=(0,c.mi)({nonNull:!0}),[r,i]=(0,n.useState)(e.defaultTab),o=(0,c.xb)({onCopyQuery:e.onCopyQuery}),l=(0,c.Ln)();return(0,n.useEffect)((()=>{a&&p(a)}),[r,a]),(0,n.useEffect)((()=>{s&&p(s)}),[r,s]),(0,n.useEffect)((()=>{t&&(t.setOption("lineNumbers",!1),t.setOption("extraKeys",{"Alt-G":()=>{t.replaceSelection("@")}}),t.setOption("gutters",[]),t.on("change",p),p(t))}),[t]),(0,n.useEffect)((()=>{a&&(a.setOption("lineNumbers",!1),a.setOption("gutters",[]),a.on("change",p))}),[a]),(0,n.useEffect)((()=>{s&&(s.setOption("lineNumbers",!1),s.setOption("gutters",[]),s.on("change",p))}),[s]),(0,d.jsx)(c.m_.Provider,{children:(0,d.jsxs)("div",{className:"graphiql-editors",children:[(0,d.jsx)("section",{className:"graphiql-query-editor ","aria-label":"Query Editor",children:(0,d.jsxs)("div",{className:"graphiql-query-editor-wrapper",children:[(0,d.jsx)(c.wY,{editorTheme:e.editorTheme,keyMap:e.keyMap,onCopyQuery:e.onCopyQuery,onEdit:e.onEditQuery,readOnly:e.readOnly}),(0,d.jsxs)("div",{className:"graphiql-toolbar",role:"toolbar","aria-label":"Editor Commands",children:[(0,d.jsx)(c.cl,{}),(0,d.jsx)(c.IB,{onClick:()=>l(),label:"Prettify query (Shift-Ctrl-P)",children:(0,d.jsx)(c.RG,{className:"graphiql-toolbar-icon","aria-hidden":"true"})}),(0,d.jsx)(c.IB,{onClick:()=>o(),label:"Copy query (Shift-Ctrl-C)",children:(0,d.jsx)(c.Td,{className:"graphiql-toolbar-icon","aria-hidden":"true"})})]})]})}),e.noTool?null:(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"graphiql-editor-tools p-0 text-sm ",children:(0,d.jsxs)("div",{className:"graphiql-editor-tools-tabs",children:[(0,d.jsx)("div",{className:("variables"===r?"text-slate-800":"")+" p-2 hover:text-slate-800 cursor-pointer",onClick:()=>{i("variables"===r?"":"variables")},children:"Variables"}),(0,d.jsx)("div",{className:("headers"===r?"text-slate-800":"")+" p-2 hover:text-slate-800 cursor-pointer",onClick:()=>{i("headers"===r?"":"headers")},children:"Headers"})]})}),(0,d.jsxs)("section",{className:"graphiql-editor-tool "+(r&&r.length>0?"pt-0":"hidden p-0"),"aria-label":"variables"===r?"Variables":"Headers",children:[(0,d.jsx)(c.G0,{editorTheme:e.editorTheme,isHidden:"variables"!==r,keyMap:e.keyMap,onEdit:e.onEditVariables,readOnly:e.readOnly}),(0,d.jsx)(c.B4,{editorTheme:e.editorTheme,isHidden:"headers"!==r,keyMap:e.keyMap,onEdit:e.onEditHeaders,readOnly:e.readOnly})]})]})]})})}class u{constructor(){this.map=new Map,this.length=0}getItem(e){return this.map.get(e)}setItem(e,t){this.map.has(e)||(this.length+=1),this.map.set(e,t)}removeItem(e){this.map.has(e)&&(this.length-=1),this.map.delete(e)}clear(){this.length=0,this.map.clear()}}var m=a(2222),g=a(82192),y=a(30947);function f(){return(0,c.Vm)({nonNull:!0}).isFetching?(0,d.jsx)(c.y$,{}):null}const v={typegraph:"Typegraph",playground:"Playground"};function b(e){let{typegraph:t,query:a,code:r,headers:p={},variables:b={},panel:x="",noTool:j=!1,defaultMode:q=null,disablePlayground:k=!1}=e;const{siteConfig:{customFields:{tgUrl:N}}}=(0,i.A)(),w=(0,n.useMemo)((()=>new u),[]),S=(0,n.useMemo)((()=>(0,s.a5)({url:`${N}/${t}`})),[]),[C,A]=(0,n.useState)(q),[E,P]=(0,g.e)();return(0,d.jsxs)("div",{className:"@container miniql mb-4",children:[q&&!k?(0,d.jsx)(m.mS,{choices:v,choice:C,onChange:A}):null,(0,d.jsxs)("div",{className:(q||k?"":"md:grid @2xl:grid-cols-2")+" gap-2 w-full order-first",children:[k||!q||"typegraph"===C?(0,d.jsx)("div",{className:" bg-slate-100 rounded-lg flex flex-col mb-2 md:mb-0 relative",children:(0,d.jsx)(m.mS,{choices:{typescript:"Typescript",python:"Python"},choice:E,onChange:P,className:"ml-2",children:r?.map((e=>(0,d.jsxs)(y.A,{value:e.codeLanguage,children:[(0,d.jsxs)(l.A,{href:`https://github.com/metatypedev/metatype/blob/main/${e?.codeFileUrl}`,className:"absolute top-0 right-0 m-2 p-1",children:[e?.codeFileUrl?.split("/").pop()," \u2197"]}),(0,d.jsx)(o.A,{language:e?.codeLanguage,wrap:!0,className:"flex-1",children:e.content})]},e.codeLanguage)))})}):null,k||q&&"playground"!==C?null:(0,d.jsx)(c.ql,{fetcher:S,defaultQuery:a.loc?.source.body.trim(),defaultHeaders:JSON.stringify(p),shouldPersistHeaders:!0,variables:JSON.stringify(b),storage:w,children:(0,d.jsxs)("div",{className:"flex flex-col graphiql-container",children:[(0,d.jsx)("div",{className:"flex-1 graphiql-session",children:(0,d.jsx)(h,{defaultTab:x,noTool:j})}),(0,d.jsxs)("div",{className:"flex-auto graphiql-response min-h-[200px] p-2 mt-2 bg-slate-100 rounded-lg",children:[(0,d.jsx)(f,{}),(0,d.jsx)(c.ny,{})]})]})})]})]})}function x(e){return(0,d.jsx)(r.A,{fallback:(0,d.jsx)("div",{children:"Loading..."}),children:()=>(0,d.jsx)(b,{...e})})}},11640:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var n=a(26787),s=(a(79474),a(13274));function r(e){let{python:t,typescript:a,...r}=e;const i=[t&&{content:t.content,codeLanguage:"python",codeFileUrl:t.path},a&&{content:a.content,codeLanguage:"typescript",codeFileUrl:a.path}].filter((e=>!!e));return(0,s.jsx)(n.A,{code:0==i.length?void 0:i,...r})}},66509:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",variableDefinitions:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"stargazers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"user"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:67}};t.loc.source={body:"query {\n  stargazers {\n    login\n    user {\n      name\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function a(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){a(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){a(e,t)})),e.definitions&&e.definitions.forEach((function(e){a(e,t)}))}var n={};t.definitions.forEach((function(e){if(e.name){var t=new Set;a(e,t),n[e.name.value]=t}})),e.exports=t},59660:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});const n=a.p+"assets/images/image.drawio-3cff34f9795f8f92dd49230e78b28fc4.svg"},19017:e=>{e.exports={content:'@typegraph(\n    allow_origin=["https://metatype.dev", "http://localhost:3000"]\n  ),\n)\ndef graphql_server(g: Graph):\n  public = Policy.public()\n\n  github = HttpRuntime("https://api.github.com")\n\n  stargazer = t.struct(\n    {\n      "login": t.string().rename("login"),\n      "user": github.get(\n        "/users/{user}",\n        t.struct({"user": t.string().from_parent("login")}),\n        t.struct({"name": t.string().optional()}),\n      ),\n    }\n  )\n\n  g.expose(\n    public,\n    stargazers=github.get(\n      "/repos/metatypedev/metatype/stargazers?per_page=2",\n      t.struct({}),\n      t.list(stargazer),\n    ),\n  )',path:"examples/typegraphs/graphql-server.py"}},42671:e=>{e.exports={content:'await typegraph({\n  name: "graphql-server",\n}, (g) => {\n  const pub = Policy.public();\n\n  const github = new HttpRuntime("https://api.github.com");\n\n  const stargazer = t.struct(\n    {\n      "login": t.string().rename("login"),\n      "user": github.get(\n        t.struct({ "user": t.string().fromParent("login") }),\n        t.struct({ "name": t.string().optional() }),\n        { path: "/users/{user}" },\n      ),\n    },\n  );\n\n  g.expose({\n    stargazers: github.get(\n      t.struct({}),\n      t.list(stargazer),\n      { path: "/repos/metatypedev/metatype/stargazers?per_page=2" },\n    ),\n  }, pub);\n});',path:"examples/typegraphs/graphql-server.ts"}}}]);